import React,{useState,useEffect}from'react';import{View,Text,StyleSheet,TouchableOpacity,LayoutAnimation}from'react-native';import{colors,radius,spacing,font}from'../theme';import CategoryPill from './CategoryPill';import type{Task,Subtask,CategoryKey}from'../types';interface Props{task:Task;onToggle:(id:string)=>void;onToggleSub:(taskId:string,subId:string)=>void;}export default function TaskItem({task,onToggle,onToggleSub}:Props){const[open,setOpen]=useState(Boolean(task.subtasks?.length));useEffect(()=>{if((task.subtasks?.length||0)>0&&!open){setOpen(true);}},[task.subtasks?.length]);const toggleOpen=()=>{LayoutAnimation.configureNext(LayoutAnimation.Presets.easeInEaseOut);setOpen(v=>!v);};return(<View style={styles.card}><View style={styles.header}><View style={{flexDirection:'row',gap:6,flexWrap:'wrap'}}>{task.categories.map((c:CategoryKey)=>(<CategoryPill key={c} category={c}/>))}</View>{task.dueAt?<Text style={styles.time}>⏰ {new Date(task.dueAt).toLocaleTimeString().slice(0,5)}</Text>:null}</View><TouchableOpacity style={styles.row} onPress={()=>onToggle(task.id)} onLongPress={toggleOpen}><View style={[styles.checkbox,task.done&&styles.checkboxOn]}/><Text style={[styles.title,task.done&&styles.done]}>{task.title||'(без названия)'}</Text></TouchableOpacity>{open&&task.subtasks?.length?(<View style={styles.subs}>{task.subtasks.map((s:Subtask)=>(<TouchableOpacity key={s.id} style={styles.subrow} onPress={()=>onToggleSub(task.id,s.id)}><View style={[styles.subDot,s.done&&styles.subDotOn]}/><Text style={[styles.subtext,s.done&&styles.subdone]}>{s.title}</Text></TouchableOpacity>))}</View>):null}</View>);}const styles=StyleSheet.create({card:{backgroundColor:colors.card,borderRadius:radius.xl,padding:spacing(2),marginBottom:spacing(2),borderWidth:1,borderColor:colors.border},header:{flexDirection:'row',justifyContent:'space-between',alignItems:'center',marginBottom:spacing(1)},row:{flexDirection:'row',alignItems:'center',gap:spacing(1.5)},checkbox:{width:22,height:22,borderRadius:12,borderWidth:2,borderColor:colors.border,backgroundColor:'transparent'},checkboxOn:{backgroundColor:colors.accent,borderColor:colors.accent},title:{color:colors.text,fontSize:font.title,fontWeight:'700'},done:{color:colors.subtext,textDecorationLine:'line-through'},time:{color:colors.subtext,fontSize:14},subs:{marginTop:spacing(1.5),paddingLeft:spacing(3)},subrow:{flexDirection:'row',alignItems:'center',gap:spacing(1),paddingVertical:4},subDot:{width:8,height:8,borderRadius:4,backgroundColor:colors.border},subDotOn:{backgroundColor:colors.accent},subtext:{color:colors.subtext,fontSize:font.text},subdone:{textDecorationLine:'line-through',color:'#6b7280'}});